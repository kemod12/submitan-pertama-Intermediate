const CACHE_NAME="story-map-v3",isProduction="localhost"!==self.location.hostname&&"127.0.0.1"!==self.location.hostname,BASE_PATH=isProduction?"/submitan-pertama-Intermediate":"",createPath=t=>(BASE_PATH?`${BASE_PATH}${t}`:t).replace(/\/+/g,"/"),CACHE_ASSETS=[createPath("/index.html"),createPath("/app.bundle.js"),createPath("/app.css"),createPath("/images/logo.png"),createPath("/favicon.png"),createPath("/offline.html")];self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>(console.log("Caching assets"),t.addAll(CACHE_ASSETS)))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return console.log("Clearing old cache"),caches.delete(t)}))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(t=>{const{request:e}=t,a=new URL(e.url);e.url.includes("/v1/")||e.url.includes("story-api.dicoding.dev")||a.origin===self.location.origin&&("navigate"!==e.mode?t.respondWith(caches.match(e).then((t=>t&&!e.url.includes("/v1/")?t:e.url.includes("/v1/")?fetch(e).catch((()=>t||new Response(JSON.stringify({error:"Offline"}),{status:503,headers:{"Content-Type":"application/json"}}))):fetch(e).then((t=>{if(!t||200!==t.status||"basic"!==t.type)return t;const a=t.clone();return"GET"===e.method&&caches.open(CACHE_NAME).then((t=>{t.put(e,a)})),t})).catch((()=>t||("image"===e.destination?new Response("",{status:404}):t)))))):t.respondWith(fetch(e).then((t=>{const a=t.clone();return caches.open(CACHE_NAME).then((t=>{t.put(e,a)})),t})).catch((()=>caches.match(e).then((t=>{if(t)return t;const e=createPath("/offline.html");return caches.match(e)||caches.match("/offline.html")}))))))})),self.addEventListener("push",(t=>{let e={};try{if(t.data){const a=t.data.text();e=a?JSON.parse(a):t.data.json()}}catch(t){console.error("Error parsing push data:",t),e={title:"New Update",message:"You have a new notification!"}}const a=e.title||"New Update",i=e.icon||createPath("/images/logo.png"),n=e.badge||createPath("/images/logo.png"),s={body:e.message||e.body||"There is a new update available!",icon:i,badge:n,tag:e.tag||"default-notification",requireInteraction:e.requireInteraction||!1,data:{url:e.url||createPath("/")},actions:[{action:"view-details",title:"View Details"},{action:"dismiss",title:"Dismiss"}]};t.waitUntil(self.registration.showNotification(a,s).catch((t=>{console.error("Error showing notification:",t)})))})),self.addEventListener("notificationclick",(t=>{t.notification.close(),"view-details"===t.action&&t.notification.data.url?t.waitUntil(clients.openWindow(t.notification.data.url)):"dismiss"===t.action||t.notification.data&&t.notification.data.url&&t.waitUntil(clients.openWindow(t.notification.data.url))})),self.addEventListener("sync",(t=>{"sync-stories"===t.tag&&t.waitUntil(self.clients.matchAll().then((t=>Promise.all(t.map((t=>t.postMessage({type:"SYNC_STORIES"})))))))})),self.addEventListener("message",(t=>{t.data&&"TRIGGER_SYNC"===t.data.type&&t.waitUntil(self.clients.matchAll().then((t=>{t.forEach((t=>{t.postMessage({type:"SYNC_STORIES"})}))})))}));