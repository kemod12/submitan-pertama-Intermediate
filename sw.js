const CACHE_NAME="story-map-v1",CACHE_ASSETS=["/","/index.html","/app.bundle.js","/app.css","/images/logo.png","/favicon.png"];async function syncStories(){const t=await caches.open("story-queue"),e=await t.keys();return Promise.all(e.map((async e=>{try{const i=await fetch(e);return i.ok&&await t.delete(e),i}catch(t){throw console.error("Sync failed:",t),t}})))}self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>(console.log("Caching assets"),t.addAll(CACHE_ASSETS)))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return console.log("Clearing old cache"),caches.delete(t)}))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(t=>{t.request.url.startsWith(self.location.origin)&&t.respondWith(caches.match(t.request).then((e=>{if(e)return e;const i=t.request.clone();return fetch(i).then((e=>{if(!e||200!==e.status||"basic"!==e.type)return e;const i=e.clone();return"GET"!==t.request.method||t.request.url.includes("/v1/")||caches.open(CACHE_NAME).then((e=>{e.put(t.request,i)})),e}))})).catch((()=>caches.match("/offline.html"))))})),self.addEventListener("push",(t=>{if(!t.data)return;const e=t.data.json(),i=e.title||"New Update",n={body:e.message||"There is a new update available!",icon:"/images/logo.png",badge:"/images/logo.png",data:{url:e.url||"/"},actions:[{action:"view-details",title:"View Details"},{action:"dismiss",title:"Dismiss"}]};t.waitUntil(self.registration.showNotification(i,n))})),self.addEventListener("notificationclick",(t=>{t.notification.close(),"view-details"===t.action&&t.notification.data.url?t.waitUntil(clients.openWindow(t.notification.data.url)):"dismiss"===t.action||t.notification.data&&t.notification.data.url&&t.waitUntil(clients.openWindow(t.notification.data.url))})),self.addEventListener("sync",(t=>{"sync-stories"===t.tag&&t.waitUntil(syncStories())}));